<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Poki Pet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <!-- Header -->
  <header>
    Poki Pet [DEV MODE]
  </header>

  <!-- User Balance -->
  <div class="container">
    <div class="balance">Coins: <span id="coins">0</span></div>
  </div>

  <!-- ========== FARM PAGE ========== -->
  <div class="container page" id="farm-page">
    <h2>My Farm</h2>
    <div class="farm-grid" id="farm-slots">
      <!-- Slot akan di-render dari DB -->
    </div>
  </div>

  <!-- ========== SHOP PAGE ========== -->
  <div class="container page" id="shop-page" style="display:none;">
    <h2>Shop - Buy New Animals</h2>
    <div id="shop-items"></div>
  </div>

  <!-- ========== INVENTORY PAGE ========== -->
  <div class="container page" id="inventory-page" style="display:none;">
    <h2>Inventory</h2>
    <div id="inventory-list"></div>
  </div>

  <!-- ========== DEPOSIT PAGE ========== -->
  <div class="container page" id="deposit-page" style="display:none;">
    <h2>Deposit Coins</h2>
    <div class="card">
      <button onclick="deposit(100)">Deposit +100 Coins</button>
      <button onclick="deposit(500)">Deposit +500 Coins</button>
    </div>
  </div>

  <!-- ========== WITHDRAW PAGE ========== -->
  <div class="container page" id="withdraw-page" style="display:none;">
    <h2>Withdraw Coins</h2>
    <div class="card">
      <input type="number" id="withdraw-amount" placeholder="Enter amount">
      <button onclick="withdraw()">Withdraw</button>
    </div>
  </div>

  <!-- ========== MENU PAGE ========== -->
  <div class="container page" id="menu-page" style="display:none;">
    <h2>Menu (Coming Soon)</h2>
    <p>More features will be added here.</p>
  </div>

  <!-- Footer Navigation -->
  <footer>
    <button onclick="showPage('farm-page')">Farm</button>
    <button onclick="showPage('shop-page')">Shop</button>
    <button onclick="showPage('inventory-page')">Inventory</button>
    <button onclick="showPage('deposit-page')">Deposit</button>
    <button onclick="showPage('withdraw-page')">Withdraw</button>
    <button onclick="showPage('menu-page')">Menu</button>
  </footer>

  <!-- ========== SCRIPT SECTION ========== -->
  <script>
    /* =========================
       INIT SUPABASE
    ========================== */
    const SUPABASE_URL = "https://nxveoqzeoiuuweypawdd.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im54dmVvcXplb2l1dXdleXBhd2RkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4NDgxMDcsImV4cCI6MjA3MTQyNDEwN30.pnoJHATNksB5rRbHJjQvUSatn6HW79jfEdFoBRt0zAM";
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let userId = 999; // dummy user
    let coins = 0;

    /* =========================
       PAGE SWITCHER
    ========================== */
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
      document.getElementById(pageId).style.display = 'block';
    }

    /* =========================
       USER BALANCE
    ========================== */
    async function loadUser() {
      let { data, error } = await sb
        .from("users")
        .select("coins")
        .eq("id", userId)
        .single();

      if (error) {
        console.error("Load user error:", error);
      } else {
        coins = data.coins;
        document.getElementById("coins").innerText = coins;
      }
    }

    async function updateCoins(newCoins) {
      let { error } = await sb
        .from("users")
        .update({ coins: newCoins })
        .eq("id", userId);

      if (error) console.error("Update coins error:", error);
    }

    /* =========================
       FARM RENDER & CLAIM
    ========================== */
    async function renderFarm() {
      let farmSlots = document.getElementById("farm-slots");

      // contoh static sementara
      farmSlots.innerHTML = `
        <div class="slot">
          <div class="pet-soil">
            <div class="pet-emoji">üêî</div>
            <div class="soil"></div>
          </div>
          <div class="pet-name">Chicken</div>
          <div class="progress"><div class="progress-bar" style="width: 70%"></div></div>
          <button onclick="claim(10)">Claim +10</button>
        </div>
        <div class="slot">
          <div class="pet-soil">
            <div class="pet-emoji">ü¶Ü</div>
            <div class="soil"></div>
          </div>
          <div class="pet-name">Duck</div>
          <div class="progress"><div class="progress-bar" style="width: 40%"></div></div>
          <button onclick="claim(40)">Claim +40</button>
        </div>
        <div class="slot empty">
          <div class="pet-soil"><div class="soil"></div></div>
          <div class="pet-name">Empty</div>
          <button>Add Pet</button>
        </div>
        <div class="slot locked">
          <div class="pet-soil"><div class="soil"></div></div>
          <div class="pet-name">Locked</div>
          <button>Unlock (1000 coins)</button>
        </div>
      `;
    }

    async function claim(amount) {
      coins += amount;
      document.getElementById("coins").innerText = coins;
      await updateCoins(coins);

      await sb.from("transactions").insert([
        { user_id: userId, type: "claim", amount: amount, currency: "$POKI" }
      ]);
    }

    /* =========================
       SHOP
    ========================== */
    async function renderShop() {
      let shop = document.getElementById("shop-items");
      shop.innerHTML = `
        <div class="card">üêî Chicken - 100 coins (Reward: 10 / 60s) <br><button>Buy</button></div>
        <div class="card">ü¶Ü Duck - 300 coins (Reward: 40 / 180s) <br><button>Buy</button></div>
        <div class="card">üêê Goat - 800 coins (Reward: 80 / 300s) <br><button>Buy</button></div>
        <div class="card">üêÑ Cow - 1500 coins (Reward: 200 / 600s) <br><button>Buy</button></div>
      `;
    }

    /* =========================
       INVENTORY
    ========================== */
    async function renderInventory() {
      let inv = document.getElementById("inventory-list");
      inv.innerHTML = `<p>No pets in inventory</p>`;
    }

    /* =========================
       DEPOSIT / WITHDRAW
    ========================== */
    async function deposit(amount) {
      coins += amount;
      document.getElementById("coins").innerText = coins;
      await updateCoins(coins);

      await sb.from("transactions").insert([
        { user_id: userId, type: "deposit", amount: amount, currency: "$POKI" }
      ]);
    }

    async function withdraw() {
      let amount = parseInt(document.getElementById("withdraw-amount").value);
      if (amount > 0 && coins >= amount) {
        coins -= amount;
        document.getElementById("coins").innerText = coins;
        await updateCoins(coins);

        await sb.from("transactions").insert([
          { user_id: userId, type: "withdraw", amount: amount, currency: "$POKI" }
        ]);
      } else {
        alert("Invalid withdraw amount");
      }
    }

    /* =========================
       INIT APP
    ========================== */
    document.addEventListener("DOMContentLoaded", async () => {
      await loadUser();
      await renderFarm();
      await renderShop();
      await renderInventory();
    });
  </script>
</body>
</html>
