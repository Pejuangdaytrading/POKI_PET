<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Poki Pet - Crypto Animal Farm</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f4f4f4; }
    header { background: #4CAF50; color: white; padding: 10px; text-align: center; }
    .user-info { background:#e0ffe0; padding:8px; font-size:14px; border-bottom:1px solid #ccc; }
    .balance { margin: 10px; font-weight: bold; }
    .farm-area { display: flex; justify-content: center; gap: 20px; margin: 20px; flex-wrap: wrap; }
    .slot {
      width: 160px; height: 180px; background: #fff3d4; border: 2px solid #e0a100;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      border-radius: 10px; padding: 10px;
    }
    .progress { width: 80%; background: #ddd; border-radius: 5px; margin-top: 10px; }
    .progress-bar { height: 10px; background: #e0a100; width: 0%; border-radius: 5px; }
    .menu { position: fixed; bottom: 0; left: 0; right: 0; background: white;
      display: flex; justify-content: space-around; border-top: 1px solid #ccc; padding: 10px 0;
    }
    .menu button { border: none; background: none; font-size: 14px; }
    .page { display: none; padding: 20px; }
    .shop-item { background: white; padding: 10px; margin: 10px 0; border-radius: 10px; border: 1px solid #ccc; }
  </style>
</head>
<body>

  <header>
    Poki Pet - Crypto Animal Farm üêî
  </header>

  <!-- User Info -->
  <div id="userInfo" class="user-info">
    Loading user...
  </div>

  <div class="balance">
    Coins: <span id="coins">0</span>
  </div>

  <!-- Farm Page -->
  <div id="farmPage" class="page" style="display:block;">
    <div class="farm-area" id="farmSlots"></div>
  </div>

  <!-- Shop Page -->
  <div id="shopPage" class="page">
    <h3>Shop - Buy New Animals</h3>
    <div class="shop-item">ü¶Ü Duck - 50 coins (Reward: 30)<br>
      <button onclick="buyAnimal(selectedSlot,'ü¶Ü',50,30)">Buy Duck</button>
    </div>
    <div class="shop-item">üêê Goat - 150 coins (Reward: 50)<br>
      <button onclick="buyAnimal(selectedSlot,'üêê',150,50)">Buy Goat</button>
    </div>
    <div class="shop-item">üêÑ Cow - 300 coins (Reward: 100)<br>
      <button onclick="buyAnimal(selectedSlot,'üêÑ',300,100)">Buy Cow</button>
    </div>
  </div>

  <!-- Deposit Page -->
  <div id="depositPage" class="page">
    <h3>Deposit Coins</h3>
    <button onclick="deposit(100)">Deposit +100 Coins</button>
    <button onclick="deposit(500)">Deposit +500 Coins</button>
  </div>

  <!-- Withdraw Page -->
  <div id="withdrawPage" class="page">
    <h3>Withdraw Coins</h3>
    <input type="number" id="withdrawAmount" placeholder="Enter amount">
    <button onclick="withdraw()">Withdraw</button>
  </div>

  <!-- Menu Page -->
  <div id="menuPage" class="page"><h3>Menu (Coming Soon)</h3></div>

  <!-- Bottom Menu -->
  <div class="menu">
    <button onclick="showTab('farmPage')">üêî Farm</button>
    <button onclick="showTab('shopPage')">üõí Shop</button>
    <button onclick="showTab('depositPage')">üí∞ Deposit</button>
    <button onclick="showTab('withdrawPage')">üè¶ Withdraw</button>
    <button onclick="showTab('menuPage')">‚ò∞ Menu</button>
  </div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
/* === Telegram WebApp Init === */
let tg = window.Telegram.WebApp;
tg.expand();

let user = tg.initDataUnsafe?.user || { id: "guest", first_name: "Guest" };
document.getElementById("userInfo").innerText =
  `User: ${user.first_name} (ID: ${user.id})`;

/* === Game Logic === */
let coins = localStorage.getItem("coins") ? parseInt(localStorage.getItem("coins")) : 0;
document.getElementById("coins").textContent = coins;

// 4 slots (1 free chicken, 3 locked)
let slots = [
  { unlocked: true, animal: { emoji: "üêî", reward: 15 }, progress: 0, raising: false, timer: null },
  { unlocked: false, price: 100, animal: null, progress: 0, raising: false, timer: null },
  { unlocked: false, price: 300, animal: null, progress: 0, raising: false, timer: null },
  { unlocked: false, price: 500, animal: null, progress: 0, raising: false, timer: null }
];

let selectedSlot = null;

function renderFarm() {
  let farm = document.getElementById("farmSlots");
  farm.innerHTML = "";
  slots.forEach((slot, i) => {
    let id = i+1;
    let div = document.createElement("div");
    div.className = "slot";

    if (!slot.unlocked) {
      div.innerHTML = `<div>üîí Locked</div><button onclick="unlockSlot(${id})">Unlock (${slot.price} coins)</button>`;
    } else if (!slot.animal) {
      div.innerHTML = `<div>‚ùì Empty</div><button onclick="selectSlot(${id})">Buy Animal</button>`;
    } else {
      div.innerHTML = `
        <div id="animal${id}">${slot.animal.emoji}</div>
        <div class="progress"><div class="progress-bar" id="progressBar${id}"></div></div>
        <button onclick="raiseAnimal(${id})">Raise</button>
        <button onclick="collectAnimal(${id})">Collect</button>
      `;
    }
    farm.appendChild(div);
  });
}
renderFarm();

function unlockSlot(id) {
  let slot = slots[id-1];
  if (coins < slot.price) { alert("Not enough coins!"); return; }
  coins -= slot.price;
  saveCoins();
  slot.unlocked = true;
  renderFarm();
}

function selectSlot(id) { selectedSlot = id; showTab('shopPage'); }

function buyAnimal(slotId, emoji, price, reward) {
  if (coins < price) { alert("Not enough coins!"); return; }
  let slot = slots[slotId-1];
  if (!slot.unlocked) { alert("Slot locked!"); return; }
  coins -= price; saveCoins();
  slot.animal = { emoji, reward };
  renderFarm();
  alert("You bought a new " + emoji);
  showTab('farmPage');
}

function raiseAnimal(id) {
  let slot = slots[id-1];
  if (!slot.animal) return;
  if (slot.raising) { alert("Already raising!"); return; }
  slot.progress = 0; slot.raising = true;
  document.getElementById("animal"+id).textContent = slot.animal.emoji;
  slot.timer = setInterval(() => {
    slot.progress += 10;
    document.getElementById("progressBar"+id).style.width = slot.progress + "%";
    if (slot.progress >= 100) {
      clearInterval(slot.timer);
      document.getElementById("animal"+id).textContent = "ü•ö";
      slot.raising = false;
    }
  }, 1000);
}

function collectAnimal(id) {
  let slot = slots[id-1];
  if (slot.progress < 100) { alert("Not ready!"); return; }
  coins += slot.animal.reward; saveCoins();
  document.getElementById("animal"+id).textContent = slot.animal.emoji;
  document.getElementById("progressBar"+id).style.width = "0%";
  slot.progress = 0;
}

function deposit(amount) { coins += amount; saveCoins(); alert("Deposited " + amount + " coins!"); }

function withdraw() {
  let amt = parseInt(document.getElementById("withdrawAmount").value);
  if (isNaN(amt) || amt <= 0) { alert("Enter valid amount!"); return; }
  if (amt < 50) { alert("Minimum withdraw 50 coins!"); return; }
  if (coins < amt) { alert("Not enough coins!"); return; }
  coins -= amt; saveCoins(); alert("Withdrew " + amt + " coins (dummy).");
}

function saveCoins() {
  localStorage.setItem("coins", coins);
  document.getElementById("coins").textContent = coins;
}

function showTab(tab) {
  document.querySelectorAll(".page").forEach(p => p.style.display = "none");
  document.getElementById(tab).style.display = "block";
}
</script>

</body>
</html>
